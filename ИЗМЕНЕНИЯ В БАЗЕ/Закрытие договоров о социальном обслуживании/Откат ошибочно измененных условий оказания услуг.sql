/*
    При закрытии условий оказаний социальных услуг у некоторых назначений социальных услуг было забыто добавлено условие о том, чтобы дата окончания была пустой,
    из-за чего были изменены еще те условия, которые были закрыты давно. Поэтому возвращаем старые значения.
*/


--------------------------------------------------------------------------------------------------------------------------------


--Удаление временных таблиц-
IF OBJECT_ID('tempdb..#OLD_DATA_CONDITION') IS NOT NULL BEGIN DROP TABLE #OLD_DATA_CONDITION END --Старая информация ошибочно измененных-

--------------------------------------------------------------------------------------------------------------------------------


--Создание временных таблиц-
CREATE TABLE #OLD_DATA_CONDITION (
    OUID        INT,        --Идентификатор-
    TS          DATETIME,   --Время изменения-
    STATUS      INT,        --Статус-
    EDITOR      INT,        --Редактор-
    STOP_DATE   DATETIME,   --Время окончания-
)


--------------------------------------------------------------------------------------------------------------------------------


--Запись старой информации условий оказаний социальных услуг.
INSERT INTO #OLD_DATA_CONDITION (OUID, TS, STATUS, EDITOR, STOP_DATE)
VALUES
(	102634	,	CONVERT(DATETIME,'05-02-2020 15:03:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	102989	,	CONVERT(DATETIME,'06-02-2020 11:13:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	103013	,	CONVERT(DATETIME,'06-02-2020 11:33:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	103084	,	CONVERT(DATETIME,'08-09-2020 15:00:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	103989	,	CONVERT(DATETIME,'06-11-2020 9:18:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	104025	,	CONVERT(DATETIME,'20200205 15:21:22')	,	13	,	10463402	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	104035	,	CONVERT(DATETIME,'30-01-2020 13:16:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191130 12:00:00')	)	,
(	104165	,	CONVERT(DATETIME,'06-02-2020 11:02:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	104803	,	CONVERT(DATETIME,'09-11-2020 9:49:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200930 12:00:00')	)	,
(	105404	,	CONVERT(DATETIME,'20200819 16:45:30')	,	13	,	10463453	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	105642	,	CONVERT(DATETIME,'23-04-2020 8:45:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200229 12:00:00')	)	,
(	105720	,	CONVERT(DATETIME,'23-09-2020 13:12:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	105732	,	CONVERT(DATETIME,'06-02-2020 10:23:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	106355	,	CONVERT(DATETIME,'15-06-2020 12:00:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	106587	,	CONVERT(DATETIME,'26-08-2020 17:53:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200630 12:00:00')	)	,
(	106605	,	CONVERT(DATETIME,'24-04-2020 8:12:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200229 12:00:00')	)	,
(	106608	,	CONVERT(DATETIME,'14-01-2021 14:47:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	106921	,	CONVERT(DATETIME,'03-02-2020 14:48:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	106928	,	CONVERT(DATETIME,'03-02-2020 14:53:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	107423	,	CONVERT(DATETIME,'23-09-2020 9:16:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	107434	,	CONVERT(DATETIME,'20200923 09:13:22')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	107547	,	CONVERT(DATETIME,'20200423 16:33:40')	,	13	,	10463453	,	CONVERT(DATETIME,'20200229 12:00:00')	)	,
(	107760	,	CONVERT(DATETIME,'11-12-2019 16:38:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191031 12:00:00')	)	,
(	107784	,	CONVERT(DATETIME,'20200908 15:20:42')	,	13	,	10384276	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	108016	,	CONVERT(DATETIME,'22-09-2020 15:12:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	108067	,	CONVERT(DATETIME,'06-02-2020 10:14:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20191231 12:00:00')	)	,
(	108687	,	CONVERT(DATETIME,'23-09-2020 14:07:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	108690	,	CONVERT(DATETIME,'23-09-2020 14:03:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	108704	,	CONVERT(DATETIME,'30-01-2020 13:34:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20191130 12:00:00')	)	,
(	113251	,	CONVERT(DATETIME,'16-07-2020 10:46:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	113255	,	CONVERT(DATETIME,'09-06-2020 8:33:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200331 12:00:00')	)	,
(	113447	,	CONVERT(DATETIME,'23-09-2020 10:09:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	113452	,	CONVERT(DATETIME,'23-09-2020 10:13:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	113847	,	CONVERT(DATETIME,'22-04-2020 15:31:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200229 12:00:00')	)	,
(	113852	,	CONVERT(DATETIME,'16-07-2020 14:27:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	117579	,	CONVERT(DATETIME,'07-08-2020 11:58:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200630 12:00:00')	)	,
(	117958	,	CONVERT(DATETIME,'13-01-2021 14:21:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	118583	,	CONVERT(DATETIME,'19-08-2020 11:50:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	119570	,	CONVERT(DATETIME,'22-09-2020 13:29:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	119586	,	CONVERT(DATETIME,'07-12-2020 9:26:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	119767	,	CONVERT(DATETIME,'16-06-2020 15:47:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200430 12:00:00')	)	,
(	119867	,	CONVERT(DATETIME,'12-10-2020 14:22:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	119868	,	CONVERT(DATETIME,'09-11-2020 10:53:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	119892	,	CONVERT(DATETIME,'03-12-2020 16:36:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	119895	,	CONVERT(DATETIME,'08-10-2020 15:50:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	120398	,	CONVERT(DATETIME,'25-08-2020 10:57:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200630 12:00:00')	)	,
(	120537	,	CONVERT(DATETIME,'23-09-2020 9:32:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	120611	,	CONVERT(DATETIME,'02-12-2020 16:28:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	121155	,	CONVERT(DATETIME,'13-10-2020 8:29:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	121261	,	CONVERT(DATETIME,'20200907 16:33:34')	,	13	,	10463453	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	121323	,	CONVERT(DATETIME,'20201012 15:50:51')	,	13	,	10463453	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	121697	,	CONVERT(DATETIME,'12-10-2020 16:29:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	122140	,	CONVERT(DATETIME,'13-10-2020 11:35:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	122183	,	CONVERT(DATETIME,'12-10-2020 16:14:00')	,	13	,	10463402	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	122731	,	CONVERT(DATETIME,'14-01-2021 11:48:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	122736	,	CONVERT(DATETIME,'09-11-2020 14:42:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20200930 12:00:00')	)	,
(	122739	,	CONVERT(DATETIME,'07-12-2020 11:09:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	123309	,	CONVERT(DATETIME,'12-01-2021 16:53:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	123411	,	CONVERT(DATETIME,'07-12-2020 9:18:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	123427	,	CONVERT(DATETIME,'14-01-2021 8:25:00')	,	13	,	10384276	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	123448	,	CONVERT(DATETIME,'20201204 10:12:44')	,	13	,	10384276	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	124235	,	CONVERT(DATETIME,'14-01-2021 11:01:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	124629	,	CONVERT(DATETIME,'13-01-2021 16:08:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	124630	,	CONVERT(DATETIME,'03-02-2021 14:04:00')	,	13	,	10463453	,	CONVERT(DATETIME,'20201231 12:00:00')	)	,
(	103803	,	CONVERT(DATETIME,'03-11-2020 14:24:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200930 12:00:00')	)	,
(	108507	,	CONVERT(DATETIME,'03-06-2020 15:49:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200331 12:00:00')	)	,
(	110668	,	CONVERT(DATETIME,'29-12-2020 13:29:00')	,	13	,	11532282	,	CONVERT(DATETIME,'20201231 12:00:00')	)	,
(	111996	,	CONVERT(DATETIME,'06-07-2020 16:05:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200430 12:00:00')	)	,
(	112025	,	CONVERT(DATETIME,'13-07-2020 8:55:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	112034	,	CONVERT(DATETIME,'15-05-2020 14:50:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200331 12:00:00')	)	,
(	112098	,	CONVERT(DATETIME,'16-09-2020 16:09:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	112099	,	CONVERT(DATETIME,'16-09-2020 16:08:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200731 12:00:00')	)	,
(	112438	,	CONVERT(DATETIME,'02-06-2020 13:07:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200331 12:00:00')	)	,
(	113027	,	CONVERT(DATETIME,'29-12-2020 13:33:00')	,	13	,	11532282	,	CONVERT(DATETIME,'20201231 12:00:00')	)	,
(	117781	,	CONVERT(DATETIME,'20200515 14:34:20')	,	13	,	10466709	,	CONVERT(DATETIME,'20200331 12:00:00')	)	,
(	118544	,	CONVERT(DATETIME,'01-09-2020 10:35:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	119216	,	CONVERT(DATETIME,'02-09-2020 13:25:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200531 12:00:00')	)	,
(	119607	,	CONVERT(DATETIME,'10-11-2020 15:02:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	119621	,	CONVERT(DATETIME,'28-08-2020 13:51:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200630 12:00:00')	)	,
(	120212	,	CONVERT(DATETIME,'02-12-2020 11:07:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	120311	,	CONVERT(DATETIME,'13-10-2020 15:33:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	120888	,	CONVERT(DATETIME,'27-11-2020 8:20:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	121423	,	CONVERT(DATETIME,'11-01-2021 14:29:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20201031 12:00:00')	)	,
(	121440	,	CONVERT(DATETIME,'03-11-2020 13:45:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	121999	,	CONVERT(DATETIME,'10-11-2020 15:12:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	122001	,	CONVERT(DATETIME,'10-11-2020 15:18:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20200831 12:00:00')	)	,
(	122786	,	CONVERT(DATETIME,'09-01-2021 11:58:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20201130 12:00:00')	)	,
(	123495	,	CONVERT(DATETIME,'30-12-2020 14:45:00')	,	13	,	10466709	,	CONVERT(DATETIME,'20201130 12:00:00')	)	


--------------------------------------------------------------------------------------------------------------------------------


--Возвращение старых значений.
UPDATE condition
SET condition.A_TS = oldData.TS,                --Отмечаем старое время изменения.
    condition.A_EDITOWNER = oldData.EDITOR,     --Ставим старого пользователя, изменившего запись.
    condition.A_LASTDATE = oldData.STOP_DATE    --Ставим дату окончания.
FROM WM_COND_SOC_SERV condition
    INNER JOIN #OLD_DATA_CONDITION oldData
        ON oldData.OUID = condition.A_OUID


--------------------------------------------------------------------------------------------------------------------------------
